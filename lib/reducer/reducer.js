"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _lodash=_interopRequireDefault(require("lodash.maxby")),_initializeOptions=require("../initializeOptions/initializeOptions"),_constants=require("../util/constants");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var setOption=function(a,b){var c=b.key,d=b.value;return _defineProperty({},c,d)},setPlaylist=function(a,b){var c=b.playlist;return{current:0,shuffled:!1,playlist:c.map(function(a,b){return _objectSpread({},a,{shufflePosition:b})})}},add=function(a,b){var c=b.media,d=b.playNow,e=(0,_lodash["default"])(a.playlist,"shufflePosition"),f=_objectSpread({},c,{shufflePosition:void 0===e?0:e.shufflePosition+1}),g=[].concat(_toConsumableArray(a.playlist),[f]),h=a.current;return d?h=g.length-1:1===g.length&&(h=0),{playlist:g,playNow:d,current:h}},remove=function(a,b){var c=b.index,d=_toConsumableArray(a.playlist),e=a.current,f=a.shuffled;return d.splice(c,1),d.length?c===a.current?e=c<d.length?a.current:d.length-1:c<a.current&&(e-=1):f=!1,{playlist:d,current:e,shuffled:f}},clear=function(){return{playlist:[]}},select=function(a,b){var c=b.index;return{current:0>c?a.playlist.length+c:c}},play=function(a,b){var c=b.index,d=void 0===c?a.current:c;return{current:0>d?a.playlist.length+d:d,playNow:!0}},shuffle=function(a,b){var c,d=b.shuffled,e=void 0===d?!a.shuffled:d,f=b.playNow,g=b.shuffleSort;return c=e?_toConsumableArray(a.playlist).sort(function(){return g}):_toConsumableArray(a.playlist).sort(function(c,a){return c.shufflePosition-a.shufflePosition}),{playlist:c,shuffled:e,playNow:f}},next=function(a){var b="loop-playlist"===a.loop?0:a.current,c=a.current+1<a.playlist.length,d=!0;return c||"off"!==a.loop||(d=!1),{current:c?a.current+1:b,playNow:d}},previous=function(a){var b=a.loopOnPrevious?a.playlist.length-1:a.current;return 0<=a.current-1&&(b=a.current-1),{current:b,playNow:!0}},updateJPlaylist=function(a,b,c){var d=c(a[b.id],b),e=a[b.id];return _objectSpread({},a,_defineProperty({},b.id,_objectSpread({},e,{},d)))},reducer=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:_initializeOptions.initialState,b=1<arguments.length?arguments[1]:void 0,c=function(c){return updateJPlaylist(a,b,c)};switch(b.type){case _constants.actionNames.SET_OPTION:return c(setOption);case _constants.actionNames.SET_PLAYLIST:return c(setPlaylist);case _constants.actionNames.ADD:return c(add);case _constants.actionNames.REMOVE:return c(remove);case _constants.actionNames.CLEAR:return c(clear);case _constants.actionNames.SELECT:return c(select);case _constants.actionNames.PLAY:return c(play);case _constants.actionNames.SHUFFLE:return c(shuffle);case _constants.actionNames.NEXT:return c(next);case _constants.actionNames.PREVIOUS:return c(previous);default:return a;}},_default=reducer;exports["default"]=_default;